# 快速开始

- 运行 `npm install` 安装依赖
- 运行 `npm start` 启动服务器
- 运行 `npm run dev` 测试执行函数

# 飞书二维码扫描字段插件

这是一个飞书多维表格的字段插件，用于从图片附件中扫描二维码内容。用户可以选择包含二维码图片的附件字段，插件会下载并分析图片文件，识别其中的二维码并将内容以文本格式返回。

## 功能特性

- 从图片附件中扫描和识别二维码内容
- 支持多种图片格式（JPEG、PNG、WebP、GIF等）
- 单选附件字段输入，简化操作流程
- 智能二维码识别，准确提取文本内容
- 错误处理机制，处理失败时显示友好错误信息
- 支持多语言（中文、英文、日文）
- 丰富的日志上下文，便于检索和调试

## 使用方法

1. 在多维表格中添加该字段插件
2. 在附件字段选择器中选择一个包含二维码图片的附件字段
3. 执行操作，插件会：
   - 下载选中字段中的图片文件
   - 使用先进的图像处理技术分析图片
   - 识别图片中的二维码内容
   - 返回二维码中包含的文本信息
4. 如果图片中没有二维码或处理失败，会显示相应的提示信息

## 技术实现

插件使用以下核心技术：

- **jsQR** - 纯JavaScript二维码识别库，支持各种二维码格式
- **Canvas API** - Node.js canvas库，用于图像处理和像素数据提取
- **图像格式支持** - 支持JPEG、PNG、WebP、GIF等常见图像格式
- **错误处理** - 完善的异常处理机制，确保用户体验

## 二维码支持类型

插件支持识别各种类型的二维码内容：

- **纯文本** - 普通文字内容
- **网址链接** - HTTP/HTTPS链接
- **联系信息** - vCard格式的联系人信息  
- **WiFi配置** - WiFi网络连接信息
- **其他格式** - 任何符合二维码标准的文本内容

## 国际化键值说明

- `inputText` - 附件字段选择标签
- `errorProcessing` - 通用错误消息
- `parseSuccess` - 二维码扫描成功消息
- `parseFailed` - 二维码扫描失败消息
- `noQRData` - 未找到二维码提示
- `downloadError` - 下载附件失败提示
- `noFieldsSelected` - 未选择字段时的错误提示

## 日志记录

每行日志都带有标准化的上下文字段前缀，便于跟踪和检索：

`[logID=...] [packID=...] [tenantKey=...] [baseID=...] [tableID=...] [baseOwnerID=...] [timeZone=...] [isNeedPayPack=...] [hasQuota=...] [baseSignature=...]`

## 脚本命令

- `npm start` — 使用 Basekit CLI 运行
- `npm run dev` — 本地执行测试
- `npm run build` — 构建字段包
- `npm run pack` — 创建 `output/output.zip`

# 发布

运行 `npm run pack` 创建 output/output.zip 文件

